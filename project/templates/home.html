<!DOCTYPE html>
<html lang="en">
<head>
	<title>Movie Network</title>
	<!-- Meta -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
	<meta name="author" content="CodeBunnyz" />

	<!-- Required Fremwork -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap/css/bootstrap.min.css') }}">
	<!-- Font Awesome -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/font-awesome-n.min.css') }}">
	<!-- Style.css -->
	<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
	
	<script type="text/javascript" src="../static/js/jquery-3.6.0.min.js"></script>

	<script src="../static/js/card.js">  </script>
	<script src="../static/js/jquery.min.js"></script>
	<link href="{{ url_for('static', filename='css/jquery.rateyo.min.css')}}" rel="stylesheet"/>
	<script src="../static/js/jquery.rateyo.min.js"></script>

	<script>
	{% if mysqlSearchResults %}
		$(document).ready(function() {
			// Your code to run since DOM is loaded and ready
			generate_cards({{mysqlSearchResults|safe}}, {{uid}});
		});
	{% endif %}

	</script>
	


</head>
<body>
	<div class="pcoded-main-container">
		<div class="pcoded-content">
			<!-- Page-header start -->
			<div class="page-header">
				<div class="page-block">
					<div class="row align-items-center">
						<div class="col-md-8">
							<div class="page-header-title">
								<h5 class="m-b-10">Movie Network</h5>
								<p class="m-b-0">CodeBunnyz Database Project</p>
							</div>
						</div>
						<div class="col-md-4">
							<ul class="breadcrumb">
								{% if username %}
								   <li class="breadcrumb-item" id="username"><a href="/profile">Hi, {{username}}</a>
									</li>
									<li class="breadcrumb-item"><a href="/logout">Log Out</a>
									</li>
								{% else %}
									<li class="breadcrumb-item" id="login"><a href="/login">Log In</a>
								{% endif %}
								
							</ul>
						</div>
					</div>
				</div>
			</div>
			<!-- Page-header end -->
		</div>

		<div class="p-35 p-b-0">
			<form class="form-material" id="mysqlsearch" action="/mysqlsearch">
				<div class="form-group form-primary">
					<input type="text" name="mysqlsearch" class="form-control" placeholder="Search Movie from mysql database">
					<span class="form-bar"></span>
				</div>
			</form>
		</div>
		<!-- 

		<div class="p-35">
			<p>Search from the mysql database:</p>
			<table style="width:50%">
				<tr>
					<th>movie name</th>
				</tr>
					{% for row in mysqlSearchResults %}
				<tr>
					 <td>{{ row[2] }}</td>
				</tr>
			{% endfor %}
			</table>
		</div>
		-->

		<div class="pcoded-inner-content">
			<div class="main-body">
				<div class="page-wrapper">
					<!-- Page-body start -->
					<div class="page-body">
						<div class="row" id="mycardcontainer"></div>
					</div>
					<!-- Page-body end -->
				</div>
			</div>
		</div>

		<div class="p-35 p-b-0">
			<form class="form-material" id="neo4jsearch" action="/neo4jsearch">
				<div class="form-group form-primary">
					<input type="text" name="neo4jsearch" class="form-control" placeholder="Search Movie from neo4j database">
					<span class="form-bar"></span>
				</div>
			</form>
		</div>

		<div class="p-35">
			<p>Search from the neo4j database:</p>
			<!-- neo4j database search section start -->
			<table style="width:50%">
                <tr>
                    <th>movie name</th>
                </tr>
                
                {% for row in neo4jSearchMovieResults %}
                    <tr>
                        <td>{{ row[0]["movieTitle"] }}</td>
                    </tr>
                {% endfor %}
                
                <tr>
                    <th>actor name</th>
                </tr>
                
                {% for row in neo4jSearchActorResults %}
                    <tr>
                        <td>{{ row[0]["actor_name"] }}</td>
                    </tr>
                {% endfor %}                

			</table>
			<!-- neo4j database search section end -->
		</div>

        <div id="graph">
        </div>

	</div>

<style type="text/css">
    .node { stroke: #222; stroke-width: 1px; }
    .link { stroke: #999; stroke-opacity: .8; stroke-width: 2px; }

</style>
<script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var width = 960, height = 500;

    var color = d3.scale.category20();

    var svg = d3.select("body").append("svg").attr("width", width).attr("height", height);

    d3.json("/graph", function(error, graph) {
        if (error) return;
        graph.links = graph.links.map(function(l) {
            var sourceNode = graph.nodes.filter(function(n) {
                    return n.name === l.source;
                })[0],
                targetNode = graph.nodes.filter(function(n) {
                    return n.name === l.target;
                })[0];

            return {
                source: sourceNode,
                target: targetNode
            };
        });

        var force = d3.layout.force().charge(-200).linkDistance(60).size([width, height]).nodes(graph.nodes).links(graph.links).charge(-400).on("tick", tick).start();
        var link = svg.selectAll(".link")
                  .data(graph.links)
                  .enter().append("line")
                  .attr("class", "link");

        var node = svg.selectAll(".node")
                  .data(graph.nodes)
                  .enter().append('g')
                  .classed("node",true)
                  .call(force.drag());
              node.append("circle")
                  .attr("r", function(d) {return d.name.length*3;})
                  .style("fill", function(d) {
                    return color(d.name);
                  })

        node.append("text").attr("dx", function(d) {return -d.name.length*1.5;}).text(function (d) { return d.name; })
        function tick() {
            link.attr("x1", function(d) { return d.source.x; })
                    .attr("y1", function(d) { return d.source.y; })
                    .attr("x2", function(d) { return d.target.x; })
                    .attr("y2", function(d) { return d.target.y; });

            node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y +")"; });
        }

    });
</script>
</body>
</html>
